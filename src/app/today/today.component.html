<div class="min-vh-100 d-flex flex-column bg-light">
  <!-- Header -->
  <header class="text-white text-center py-3 shadow-sm" style="background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);">
    <div class="container">
      <h1 class="h4 fw-bold mb-1 text-white">{{ title }}</h1>
      <p style="font-size: 0.8rem;" class="mb-1 text-white opacity-75">Daily Task Organizer</p>
      <p style="font-size: 0.75rem;" class="mb-0 text-white fw-semibold opacity-90">
        üìÖ {{ currentDate | date:'fullDate' }}
      </p>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container flex-grow-1 my-4">
    <div class="row g-4">
            
      <!-- Signal Tasks Section -->
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm border-start border-success border-4 h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h2 class="h5 mb-0 d-flex align-items-center gap-2">
                <span>üéØ</span>
                <span>Signal</span>
              </h2>
              <span class="badge bg-secondary rounded-pill" style="font-size: 0.75rem;">
                {{ getCompletedCount(signalTasks()) }} / {{ signalTasks().length }}
              </span>
            </div>
            <p class="text-muted mb-3" style="font-size: 0.8rem;">Most important tasks today</p>

            <!-- Add Signal Task -->
            <div class="input-group mb-3">
              <input
                type="text"
                [(ngModel)]="newSignalTask"
                placeholder="Add a Signal task..."
                class="form-control"
                (keyup.enter)="addSignalTask()"
              />
              <button 
                class="btn btn-primary"
                (click)="addSignalTask()"
                [disabled]="!newSignalTask.trim()"
              >
                Add
              </button>
            </div>

            <!-- Signal Tasks List -->
            <div class="list-group list-group-flush">
              @if (signalTasks().length === 0) {
                <div class="text-center text-muted py-4 fst-italic">
                  No Signal tasks yet. Add your most important tasks!
                </div>
              }
              @for (task of signalTasks(); track task.id) {
                <div class="list-group-item d-flex align-items-center gap-2 bg-light rounded mb-2 border" 
                     [class.opacity-50]="task.done">
                  
                  @if (editingTaskId === task.id) {
                    <!-- Edit Mode -->
                    <div class="flex-grow-1 d-flex gap-2">
                      <input
                        type="text"
                        [(ngModel)]="editingTaskTitle"
                        class="form-control form-control-sm"
                        (keyup.enter)="saveEditTask()"
                        (keyup.escape)="cancelEditTask()"
                        autofocus
                      />
                      <button 
                        class="btn btn-sm btn-success"
                        (click)="saveEditTask()"
                        title="Save"
                      >
                        ‚úì
                      </button>
                      <button 
                        class="btn btn-sm btn-secondary"
                        (click)="cancelEditTask()"
                        title="Cancel"
                      >
                        ‚úï
                      </button>
                    </div>
                  } @else {
                    <!-- View Mode -->
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [checked]="task.done"
                        [id]="'signal-' + task.id"
                        (change)="toggleTask(task.id)"
                      />
                    </div>
                    <span class="flex-grow-1" [class.text-decoration-line-through]="task.done" [class.text-muted]="task.done">
                      {{ task.title }}
                    </span>
                    <button 
                      class="btn btn-sm btn-link text-primary p-0"
                      (click)="startEditTask(task)"
                      title="Edit task"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button 
                      class="btn btn-sm btn-link text-danger p-0 fs-4 lh-1"
                      (click)="deleteTask(task.id)"
                      title="Delete task"
                    >
                      √ó
                    </button>
                  }
                </div>
              }
            </div>

            @if (signalTasks().length > 0) {
              <button class="btn btn-outline-secondary w-100 mt-3" (click)="clearSignalTasks()">
                Clear Signal Tasks
              </button>
            }
          </div>
        </div>
      </div>

      <!-- Noise Tasks Section -->
      <div class="col-12 col-lg-6">
        <div class="card shadow-sm border-start border-danger border-4 h-100">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <h2 class="h5 mb-0 d-flex align-items-center gap-2">
                <span>üìù</span>
                <span>Noise</span>
              </h2>
              <span class="badge bg-secondary rounded-pill" style="font-size: 0.75rem;">
                {{ getCompletedCount(noiseTasks()) }} / {{ noiseTasks().length }}
              </span>
            </div>
            <p class="text-muted mb-3" style="font-size: 0.8rem;">Less important tasks</p>

            <!-- Add Noise Task -->
            <div class="input-group mb-3">
              <input
                type="text"
                [(ngModel)]="newNoiseTask"
                placeholder="Add a Noise task..."
                class="form-control"
                (keyup.enter)="addNoiseTask()"
              />
              <button 
                class="btn btn-primary"
                (click)="addNoiseTask()"
                [disabled]="!newNoiseTask.trim()"
              >
                Add
              </button>
            </div>

            <!-- Noise Tasks List -->
            <div class="list-group list-group-flush">
              @if (noiseTasks().length === 0) {
                <div class="text-center text-muted py-4 fst-italic">
                  No Noise tasks yet. Add less urgent tasks here.
                </div>
              }
              @for (task of noiseTasks(); track task.id) {
                <div class="list-group-item d-flex align-items-center gap-2 bg-light rounded mb-2 border" 
                     [class.opacity-50]="task.done">
                  
                  @if (editingTaskId === task.id) {
                    <!-- Edit Mode -->
                    <div class="flex-grow-1 d-flex gap-2">
                      <input
                        type="text"
                        [(ngModel)]="editingTaskTitle"
                        class="form-control form-control-sm"
                        (keyup.enter)="saveEditTask()"
                        (keyup.escape)="cancelEditTask()"
                        autofocus
                      />
                      <button 
                        class="btn btn-sm btn-success"
                        (click)="saveEditTask()"
                        title="Save"
                      >
                        ‚úì
                      </button>
                      <button 
                        class="btn btn-sm btn-secondary"
                        (click)="cancelEditTask()"
                        title="Cancel"
                      >
                        ‚úï
                      </button>
                    </div>
                  } @else {
                    <!-- View Mode -->
                    <div class="form-check">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [checked]="task.done"
                        [id]="'noise-' + task.id"
                        (change)="toggleTask(task.id)"
                      />
                    </div>
                    <span class="flex-grow-1" [class.text-decoration-line-through]="task.done" [class.text-muted]="task.done">
                      {{ task.title }}
                    </span>
                    <button 
                      class="btn btn-sm btn-link text-primary p-0"
                      (click)="startEditTask(task)"
                      title="Edit task"
                    >
                      ‚úèÔ∏è
                    </button>
                    <button 
                      class="btn btn-sm btn-link text-danger p-0 fs-4 lh-1"
                      (click)="deleteTask(task.id)"
                      title="Delete task"
                    >
                      √ó
                    </button>
                  }
                </div>
              }
            </div>

            @if (noiseTasks().length > 0) {
              <button class="btn btn-outline-secondary w-100 mt-3" (click)="clearNoiseTasks()">
                Clear Noise Tasks
              </button>
            }
          </div>
        </div>
      </div>

    </div>

    <!-- Signal-to-Noise Ratio Dashboard -->
    @if (metrics() && metrics()!.total > 0) {
      <div class="row g-3 mt-4">
        <div class="col-12">
          <div class="card shadow-sm border-0" style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);">
            <div class="card-body p-3">
              <h3 class="text-center fw-bold mb-3" style="font-size: 1.1rem;">üìä Signal-to-Noise Ratio Analysis</h3>
              
              <!-- Summary Message -->
              <div class="alert alert-primary border-start border-4 border-primary text-center fw-semibold">
                {{ metrics()!.summaryMessage }}
              </div>

              <!-- Metrics Grid -->
              <div class="row g-3">
                
                <!-- 1. Planned Ratio Meter -->
                <div class="col-12 col-lg-4">
                  <div class="card h-100 shadow-sm border">
                    <div class="card-body">
                      <h4 class="h6 fw-semibold mb-2">üìã Planned Ratio</h4>
                      <p class="text-muted small mb-3">Task distribution at start of day</p>
                      <div class="ratio-meter mb-3">
                        <div class="d-flex rounded overflow-hidden shadow-sm" style="height: 40px;">
                          <div class="signal-fill d-flex align-items-center justify-content-center text-white fw-bold" 
                               [style.width.%]="metrics()!.plannedSignalPercent"
                               style="background: var(--signal-color);">
                            <span>{{ metrics()!.plannedSignalPercent.toFixed(0) }}%</span>
                          </div>
                          <div class="noise-fill d-flex align-items-center justify-content-center text-white fw-bold" 
                               [style.width.%]="metrics()!.plannedNoisePercent"
                               style="background: var(--noise-color);">
                            <span>{{ metrics()!.plannedNoisePercent.toFixed(0) }}%</span>
                          </div>
                        </div>
                        <div class="d-flex justify-content-around mt-2 small fw-semibold">
                          <span class="text-success">üéØ Signal: {{ metrics()!.signalTotal }}</span>
                          <span class="text-danger">üìù Noise: {{ metrics()!.noiseTotal }}</span>
                        </div>
                      </div>
                      <p class="small p-2 rounded mb-0" 
                         [class.bg-warning-subtle]="metrics()!.plannedRatioWarning.startsWith('‚ö†Ô∏è')"
                         [class.bg-success-subtle]="!metrics()!.plannedRatioWarning.startsWith('‚ö†Ô∏è')"
                         [class.text-warning-emphasis]="metrics()!.plannedRatioWarning.startsWith('‚ö†Ô∏è')"
                         [class.text-success-emphasis]="!metrics()!.plannedRatioWarning.startsWith('‚ö†Ô∏è')">
                        {{ metrics()!.plannedRatioWarning }}
                      </p>
                    </div>
                  </div>
                </div>

                <!-- 2. Completion Progress Bars -->
                <div class="col-12 col-lg-4">
                  <div class="card h-100 shadow-sm border">
                    <div class="card-body">
                      <h4 class="h6 fw-semibold mb-2">‚úÖ Completion Progress</h4>
                      <p class="text-muted small mb-3">How well you're finishing what you planned</p>
                      <div class="mb-3">
                        <div class="mb-3">
                          <div class="d-flex justify-content-between small fw-semibold mb-1">
                            <span>üéØ Signal Tasks</span>
                            <span class="text-muted">{{ metrics()!.signalDone }} / {{ metrics()!.signalTotal }}</span>
                          </div>
                          <div class="progress" style="height: 28px;">
                            <div class="progress-bar fw-bold" 
                                 role="progressbar" 
                                 [style.width.%]="metrics()!.completionSignalPercent"
                                 style="background: var(--signal-color);">
                              {{ metrics()!.completionSignalPercent.toFixed(0) }}%
                            </div>
                          </div>
                        </div>
                        <div>
                          <div class="d-flex justify-content-between small fw-semibold mb-1">
                            <span>üìù Noise Tasks</span>
                            <span class="text-muted">{{ metrics()!.noiseDone }} / {{ metrics()!.noiseTotal }}</span>
                          </div>
                          <div class="progress" style="height: 28px;">
                            <div class="progress-bar fw-bold" 
                                 role="progressbar" 
                                 [style.width.%]="metrics()!.completionNoisePercent"
                                 style="background: var(--noise-color);">
                              {{ metrics()!.completionNoisePercent.toFixed(0) }}%
                            </div>
                          </div>
                        </div>
                      </div>
                      @if (metrics()!.completionWarning) {
                        <p class="small p-2 rounded mb-0" 
                           [class.bg-warning-subtle]="metrics()!.completionWarning.startsWith('‚ö†Ô∏è')"
                           [class.bg-success-subtle]="!metrics()!.completionWarning.startsWith('‚ö†Ô∏è')"
                           [class.text-warning-emphasis]="metrics()!.completionWarning.startsWith('‚ö†Ô∏è')"
                           [class.text-success-emphasis]="!metrics()!.completionWarning.startsWith('‚ö†Ô∏è')">
                          {{ metrics()!.completionWarning }}
                        </p>
                      }
                    </div>
                  </div>
                </div>

                <!-- 3. Effective Ratio Visualization -->
                <div class="col-12 col-lg-4">
                  <div class="card h-100 shadow-sm border">
                    <div class="card-body">
                      <h4 class="h6 fw-semibold mb-2">‚ö° Effective Productivity Ratio</h4>
                      <p class="text-muted small mb-3">How your actual daily energy was spent</p>
                      <div class="d-flex flex-column align-items-center">
                        <div class="position-relative mb-3" style="width: 120px; height: 120px;">
                          <div class="rounded-circle shadow w-100 h-100" 
                               [style.background]="'conic-gradient(var(--signal-color) 0% ' + metrics()!.effectiveSignalPercent + '%, var(--noise-color) ' + metrics()!.effectiveSignalPercent + '% 100%)'">
                          </div>
                          <div class="position-absolute top-50 start-50 translate-middle bg-white rounded-circle shadow d-flex align-items-center justify-content-center" 
                               style="width: 70px; height: 70px;">
                            <div class="d-flex align-items-center gap-1 fw-bold small">
                              <span class="text-success">{{ metrics()!.effectiveSignalPercent.toFixed(0) }}%</span>
                              <span class="text-muted">:</span>
                              <span class="text-danger">{{ metrics()!.effectiveNoisePercent.toFixed(0) }}%</span>
                            </div>
                          </div>
                        </div>
                        <div class="w-100">
                          <div class="d-flex align-items-center gap-2 small p-2 bg-light rounded mb-2">
                            <span>üéØ</span>
                            <span class="flex-grow-1 fw-semibold text-muted">Signal Done:</span>
                            <span class="fw-bold">{{ metrics()!.signalDone }} / {{ metrics()!.total }}</span>
                          </div>
                          <div class="d-flex align-items-center gap-2 small p-2 bg-light rounded">
                            <span>üìù</span>
                            <span class="flex-grow-1 fw-semibold text-muted">Noise Done:</span>
                            <span class="fw-bold">{{ metrics()!.noiseDone }} / {{ metrics()!.total }}</span>
                          </div>
                        </div>
                      </div>
                      @if (metrics()!.effectiveRatioWarning) {
                        <p class="small p-2 rounded mt-3 mb-0" 
                           [class.bg-warning-subtle]="metrics()!.effectiveRatioWarning.startsWith('‚ö†Ô∏è')"
                           [class.bg-success-subtle]="!metrics()!.effectiveRatioWarning.startsWith('‚ö†Ô∏è')"
                           [class.text-warning-emphasis]="metrics()!.effectiveRatioWarning.startsWith('‚ö†Ô∏è')"
                           [class.text-success-emphasis]="!metrics()!.effectiveRatioWarning.startsWith('‚ö†Ô∏è')">
                          {{ metrics()!.effectiveRatioWarning }}
                        </p>
                      }
                    </div>
                  </div>
                </div>

              </div>
            </div>
          </div>
        </div>
      </div>
    }
  </main>

  <!-- Footer -->
  <footer class="bg-white border-top py-3 text-center mt-auto" style="margin-bottom: 60px;">
    <div class="container">
      @if (signalTasks().length > 0 || noiseTasks().length > 0) {
        <button class="btn btn-success mb-2" style="max-width: 300px; font-size: 0.9rem;" (click)="clearAllTasks()">
          üîÑ Start Fresh Day
        </button>
      }
      <p class="text-muted mb-0" style="font-size: 0.75rem;">Tasks automatically reset each new day</p>
    </div>
  </footer>

  <!-- Bottom Navigation -->
  <nav class="shadow fixed-bottom" style="background-color: #f1f5f9; border-top: 1px solid #e2e8f0;">
    <div class="container">
      <div class="row text-center g-0">
        <div class="col-4">
          <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{exact: true}" 
             class="nav-link d-flex flex-column align-items-center text-decoration-none py-1">
            <span class="fs-6 mb-0">üìã</span>
            <span style="font-size: 0.7rem;" class="fw-semibold">Today</span>
          </a>
        </div>
        <div class="col-4">
          <a routerLink="/analytics" routerLinkActive="active" 
             class="nav-link d-flex flex-column align-items-center text-decoration-none py-1">
            <span class="fs-6 mb-0">üìä</span>
            <span style="font-size: 0.7rem;" class="fw-semibold">Analytics</span>
          </a>
        </div>
        <div class="col-4">
          <a routerLink="/history" routerLinkActive="active" 
             class="nav-link d-flex flex-column align-items-center text-decoration-none py-1">
            <span class="fs-6 mb-0">üìö</span>
            <span style="font-size: 0.7rem;" class="fw-semibold">History</span>
          </a>
        </div>
      </div>
    </div>
  </nav>

</div>
