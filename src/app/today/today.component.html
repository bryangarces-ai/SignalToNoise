<div class="app-container">
  <!-- Header -->
  <header class="app-header">
    <h1>{{ title }}</h1>
    <p class="subtitle">Daily Task Organizer</p>
    <a routerLink="/history" class="btn-history">📚 History</a>
  </header>

  <!-- Signal-to-Noise Ratio Dashboard -->
  @if (metrics() && metrics()!.total > 0) {
    <section class="metrics-dashboard">
      <h3 class="dashboard-title">📊 Signal-to-Noise Ratio Analysis</h3>
      
      <!-- Summary Message -->
      <div class="summary-message">
        {{ metrics()!.summaryMessage }}
      </div>

      <!-- Metrics Grid -->
      <div class="metrics-grid">
        
        <!-- 1. Planned Ratio Meter -->
        <div class="metric-card">
          <h4>📋 Planned Ratio</h4>
          <p class="metric-description">Task distribution at start of day</p>
          <div class="ratio-meter">
            <div class="meter-bar">
              <div class="meter-fill signal-fill" 
                   [style.width.%]="metrics()!.plannedSignalPercent">
                <span class="meter-label">{{ metrics()!.plannedSignalPercent.toFixed(0) }}%</span>
              </div>
              <div class="meter-fill noise-fill" 
                   [style.width.%]="metrics()!.plannedNoisePercent">
                <span class="meter-label">{{ metrics()!.plannedNoisePercent.toFixed(0) }}%</span>
              </div>
            </div>
            <div class="meter-legend">
              <span class="legend-item signal-legend">🎯 Signal: {{ metrics()!.signalTotal }}</span>
              <span class="legend-item noise-legend">📝 Noise: {{ metrics()!.noiseTotal }}</span>
            </div>
          </div>
          <p class="metric-warning" [class.has-warning]="metrics()!.plannedRatioWarning.startsWith('⚠️')">
            {{ metrics()!.plannedRatioWarning }}
          </p>
        </div>

        <!-- 2. Completion Progress Bars -->
        <div class="metric-card">
          <h4>✅ Completion Progress</h4>
          <p class="metric-description">How well you're finishing what you planned</p>
          <div class="progress-bars">
            <div class="progress-item">
              <div class="progress-header">
                <span>🎯 Signal Tasks</span>
                <span class="progress-value">{{ metrics()!.signalDone }} / {{ metrics()!.signalTotal }}</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill signal-progress" 
                     [style.width.%]="metrics()!.completionSignalPercent">
                  <span class="progress-label">{{ metrics()!.completionSignalPercent.toFixed(0) }}%</span>
                </div>
              </div>
            </div>
            <div class="progress-item">
              <div class="progress-header">
                <span>📝 Noise Tasks</span>
                <span class="progress-value">{{ metrics()!.noiseDone }} / {{ metrics()!.noiseTotal }}</span>
              </div>
              <div class="progress-bar">
                <div class="progress-fill noise-progress" 
                     [style.width.%]="metrics()!.completionNoisePercent">
                  <span class="progress-label">{{ metrics()!.completionNoisePercent.toFixed(0) }}%</span>
                </div>
              </div>
            </div>
          </div>
          @if (metrics()!.completionWarning) {
            <p class="metric-warning" [class.has-warning]="metrics()!.completionWarning.startsWith('⚠️')">
              {{ metrics()!.completionWarning }}
            </p>
          }
        </div>

        <!-- 3. Effective Ratio Visualization -->
        <div class="metric-card">
          <h4>⚡ Effective Productivity Ratio</h4>
          <p class="metric-description">How your actual daily energy was spent</p>
          <div class="effective-ratio">
            <div class="ratio-pie">
              <div class="pie-chart" 
                   [style.background]="'conic-gradient(var(--signal-color) 0% ' + metrics()!.effectiveSignalPercent + '%, var(--noise-color) ' + metrics()!.effectiveSignalPercent + '% 100%)'">
              </div>
              <div class="pie-center">
                <div class="pie-label">
                  <span class="pie-value signal-value">{{ metrics()!.effectiveSignalPercent.toFixed(0) }}%</span>
                  <span class="pie-divider">:</span>
                  <span class="pie-value noise-value">{{ metrics()!.effectiveNoisePercent.toFixed(0) }}%</span>
                </div>
              </div>
            </div>
            <div class="ratio-details">
              <div class="ratio-detail-item">
                <span class="detail-icon">🎯</span>
                <span class="detail-label">Signal Done:</span>
                <span class="detail-value">{{ metrics()!.signalDone }} / {{ metrics()!.total }}</span>
              </div>
              <div class="ratio-detail-item">
                <span class="detail-icon">📝</span>
                <span class="detail-label">Noise Done:</span>
                <span class="detail-value">{{ metrics()!.noiseDone }} / {{ metrics()!.total }}</span>
              </div>
            </div>
          </div>
          @if (metrics()!.effectiveRatioWarning) {
            <p class="metric-warning" [class.has-warning]="metrics()!.effectiveRatioWarning.startsWith('⚠️')">
              {{ metrics()!.effectiveRatioWarning }}
            </p>
          }
        </div>

      </div>
    </section>
  }

  <!-- Main Content -->
  <main class="main-content">
    
    <!-- Signal Tasks Section -->
    <section class="task-section signal-section">
      <div class="section-header">
        <h2>
          <span class="icon">🎯</span>
          Signal
        </h2>
        <span class="task-count">
          {{ getCompletedCount(signalTasks()) }} / {{ signalTasks().length }}
        </span>
      </div>
      <p class="section-description">Most important tasks today</p>

      <!-- Add Signal Task -->
      <div class="add-task-form">
        <input
          type="text"
          [(ngModel)]="newSignalTask"
          placeholder="Add a Signal task..."
          class="task-input"
          (keyup.enter)="addSignalTask()"
        />
        <button 
          class="btn btn-primary"
          (click)="addSignalTask()"
          [disabled]="!newSignalTask.trim()"
        >
          Add
        </button>
      </div>

      <!-- Signal Tasks List -->
      <div class="tasks-list">
        @if (signalTasks().length === 0) {
          <p class="empty-state">No Signal tasks yet. Add your most important tasks!</p>
        }
        @for (task of signalTasks(); track task.id) {
          <div class="task-item" [class.task-done]="task.done">
            <label class="task-checkbox">
              <input
                type="checkbox"
                [checked]="task.done"
                (change)="toggleTask(task.id)"
              />
              <span class="checkmark"></span>
            </label>
            <span class="task-title">{{ task.title }}</span>
            <button 
              class="btn-delete"
              (click)="deleteTask(task.id)"
              title="Delete task"
            >
              ×
            </button>
          </div>
        }
      </div>

      @if (signalTasks().length > 0) {
        <button class="btn btn-clear" (click)="clearSignalTasks()">
          Clear Signal Tasks
        </button>
      }
    </section>

    <!-- Noise Tasks Section -->
    <section class="task-section noise-section">
      <div class="section-header">
        <h2>
          <span class="icon">📝</span>
          Noise
        </h2>
        <span class="task-count">
          {{ getCompletedCount(noiseTasks()) }} / {{ noiseTasks().length }}
        </span>
      </div>
      <p class="section-description">Less important tasks</p>

      <!-- Add Noise Task -->
      <div class="add-task-form">
        <input
          type="text"
          [(ngModel)]="newNoiseTask"
          placeholder="Add a Noise task..."
          class="task-input"
          (keyup.enter)="addNoiseTask()"
        />
        <button 
          class="btn btn-primary"
          (click)="addNoiseTask()"
          [disabled]="!newNoiseTask.trim()"
        >
          Add
        </button>
      </div>

      <!-- Noise Tasks List -->
      <div class="tasks-list">
        @if (noiseTasks().length === 0) {
          <p class="empty-state">No Noise tasks yet. Add less urgent tasks here.</p>
        }
        @for (task of noiseTasks(); track task.id) {
          <div class="task-item" [class.task-done]="task.done">
            <label class="task-checkbox">
              <input
                type="checkbox"
                [checked]="task.done"
                (change)="toggleTask(task.id)"
              />
              <span class="checkmark"></span>
            </label>
            <span class="task-title">{{ task.title }}</span>
            <button 
              class="btn-delete"
              (click)="deleteTask(task.id)"
              title="Delete task"
            >
              ×
            </button>
          </div>
        }
      </div>

      @if (noiseTasks().length > 0) {
        <button class="btn btn-clear" (click)="clearNoiseTasks()">
          Clear Noise Tasks
        </button>
      }
    </section>

  </main>

  <!-- Footer -->
  <footer class="app-footer">
    @if (signalTasks().length > 0 || noiseTasks().length > 0) {
      <button class="btn btn-reset" (click)="clearAllTasks()">
        🔄 Start Fresh Day
      </button>
    }
    <p class="footer-note">Tasks automatically reset each new day</p>
  </footer>
</div>
